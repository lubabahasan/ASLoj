{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/problems/problem_detail.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>{{ problem.title }} - {{ contest.name }}</title>
</head>
<body>

{% include "nav.html" %}

{% block content %}
<div class="oj-layout container mt-4">
    <div class="problem-main">
        <h1>{{ problem.title }}</h1>
        <hr>

        <section class="problem-section">
            <h4>Statement</h4>
            <p>{{ problem.statement|safe }}</p>
        </section>

        <section class="problem-section">
            <h4>Input</h4>
            <p>{{ problem.input_specification|safe }}</p>
        </section>

        <section class="problem-section">
            <h4>Output</h4>
            <p>{{ problem.output_specification|safe }}</p>
        </section>

        {% if problem.examples %}
        <section class="problem-section">
            <h4>Examples</h4>
            {% for example in problem.examples.all %}
            <div class="example-block">
                <div class="example-label">Input</div>
                <pre><code>{{ example.input|safe }}</code></pre>
                <button class="copy-btn btn btn-sm btn-primary">Copy Input</button>
            </div>

            <div class="example-block">
                <div class="example-label">Output</div>
                <pre><code>{{ example.output|safe }}</code></pre>
                <button class="copy-btn btn btn-sm btn-primary">Copy Output</button>
            </div>

            {% if example.note %}
            <div class="example-note"><strong>Note:</strong> {{ example.note }}</div>
            {% endif %}
            {% endfor %}
        </section>
        {% endif %}
    </div>

    <aside class="problem-sidebar">
        <div class="sidebar-card">
            <h5>Problem Info</h5>
            <p><strong>Difficulty:</strong> {{ problem.get_difficulty_display }}</p>
            <p><strong>Time limit:</strong> {{ problem.time_limit }}s</p>
            <p><strong>Memory limit:</strong> 256 MB</p>
            <p><strong>Contest:</strong> {{ contest.name }}</p>
        </div>

        <div class="sidebar-card mt-4">
            <h5>Submit Solution</h5>

            {% if last_submission %}
                <div class="alert
                    {% if last_submission.verdict == 'Accepted' %}
                        alert-success
                    {% elif last_submission.verdict == 'Wrong Answer' %}
                        alert-danger
                    {% else %}
                        alert-secondary
                    {% endif %}
                    py-2 mb-3">
                    <strong>Last Verdict:</strong> {{ last_submission.verdict }}
                </div>
            {% endif %}

            <form method="POST" enctype="multipart/form-data" class="mt-3">
              {% csrf_token %}
              <div class="mb-2">
                <label for="language">Language:</label>
                {{ submission_form.language }}
              </div>
              <div class="mb-2">
                <label for="code_file">Upload Code File:</label>
                {{ submission_form.code_file }}
              </div>
              <button type="submit" class="btn btn-success">Submit</button>
            </form>
        </div>
    </aside>

    <div class="d-flex gap-2 mb-5">
        <a href="{% url 'contest_problems' contest.id %}" class="btn btn-primary">Back to Contest</a>
    </div>
</div>
{% endblock %}

<!-- JS dependencies -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'ckeditor/ckeditor/ckeditor.js' %}"></script>
<script src="{% static 'ckeditor/ckeditor-init.js' %}"></script>

<!-- copy button -->
<script>
    document.querySelectorAll(".copy-btn").forEach(btn =>
        btn.addEventListener("click", () => {
            const code = btn.closest(".example-block")?.querySelector("pre code");
            if (!code) return;
            navigator.clipboard.writeText(code.textContent)
                .then(() => {
                    const orig = btn.innerText;
                    btn.innerText = "Copied!";
                    setTimeout(() => btn.innerText = orig, 1000);
                })
                .catch(err => console.error(err));
        })
    );
</script>

</body>
</html>
