{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ contest.name }} – Problems</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
{% include "nav.html" %}

<div class="container mt-4">
  <h2 class="mb-3">{{ contest.name }} – Problems</h2>

  <!-- Contest Info -->
  <div class="card mb-4">
    <div class="card-body">
    <p><strong>Start Time:</strong> {{ contest.start_time|date:"g:i A, M d, Y" }}</p>
    <p><strong>End Time:</strong> {{ contest.end_time|date:"g:i A, M d, Y" }}</p>

    <h5 class="mt-3">
      Time Remaining:
      <span id="countdown" class="fw-bold text-danger" style="font-size: 1.5rem;">Calculating...</span>
    </h5>

    <p class="mt-2"><strong>Total Problems:</strong> {{ problems.count }}</p>
  </div>
  </div>

  <!-- Problem List -->
  {% if problems %}
  <table class="table table-striped table-bordered align-middle">
    <thead class="table-dark">
      <tr>
        <th scope="col">#</th>
        <th scope="col">Title</th>
        <th scope="col">Verdict</th>
        <th scope="col">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for problem in problems %}
      <tr>
        <td>{{ forloop.counter }}</td>
        <td>{{ problem.title }}</td>
        <td>
          {% with verdict=problem_status.problem.problem_id %}
            {% if verdict %}
              {% if verdict == 'AC' %}
                <span class="badge bg-success">Accepted</span>
              {% elif verdict == 'WA' %}
                <span class="badge bg-danger">Wrong Answer</span>
              {% elif verdict == 'RE' %}
                <span class="badge bg-warning text-dark">Runtime Error</span>
              {% elif verdict == 'TLE' %}
                <span class="badge bg-secondary">Time Limit Exceeded</span>
              {% else %}
                <span class="badge bg-secondary">{{ verdict }}</span>
              {% endif %}
            {% else %}
              <span class="text-muted">Not Attempted</span>
            {% endif %}
          {% endwith %}
        </td>
        <td>
          <a href="{% url 'contest_problem_detail' contest.id problem.problem_id %}" class="btn btn-sm btn-primary">View</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% else %}
  <div class="alert alert-warning">No problems have been added to this contest yet.</div>
  {% endif %}

  <a href="{% url 'contest_detail' contest.id %}" class="btn btn-secondary mt-3">← Back to Contest Details</a>
</div>

{% include "footer.html" %}

<script>
  const endTime = new Date("{{ contest.end_time|date:'Y-m-d H:i:s' }}").getTime();

  const countdownElement = document.getElementById("countdown");

  function updateCountdown() {
    const now = new Date().getTime();
    const timeLeft = endTime - now;

    if (timeLeft <= 0) {
      countdownElement.innerHTML = "Contest Ended";
      countdownElement.classList.remove("text-danger");
      countdownElement.classList.add("text-muted");
      clearInterval(timer);
      return;
    }

    const hours = Math.floor((timeLeft / (1000 * 60 * 60)) % 24);
    const minutes = Math.floor((timeLeft / (1000 * 60)) % 60);
    const seconds = Math.floor((timeLeft / 1000) % 60);

    countdownElement.textContent = `${hours}h ${minutes}m ${seconds}s`;
  }

  updateCountdown(); // initial call
  const timer = setInterval(updateCountdown, 1000);
</script>

</body>
</html>
